name: test-install-php-and-up-services

on:
  push:
    branches:
      - test

jobs:
  # build:
  #   runs-on: [self-hosted, ene-devarm]
  #   steps:
  #     #- uses: actions/checkout@v2
  #     - name: list files
  #       run: ls -al
      
  #     - name: Set up PHP
  #       uses: shivammathur/setup-php@master
  #       with:
  #         php-version: '7.2'

  # Label of the container job
  container-job:
    # Containers must run in Linux based operating systems
    runs-on: [self-hosted, xloo-dev-d1]
    container: nginx
    services:
      redis:
        image: redis
    steps:
      # Downloads a copy of the code in your repository before running CI tests
      - name: Check out repository code
        uses: actions/checkout@v3

      # Performs a clean installation of all dependencies in the `package.json` file
      # For more information, see https://docs.npmjs.com/cli/ci.html
      - name: Install dependencies
        run: npm ci

      - name: Connect to Redis
        # Runs a script that creates a Redis client, populates
        # the client with data, and retrieves data
        run: node client.js
        # Environment variable used by the `client.js` script to create a new Redis client.
        env:
          # The hostname used to communicate with the Redis service container
          REDIS_HOST: redis
          # The default Redis port
          REDIS_PORT: 6379      